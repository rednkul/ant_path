# ant_path
Тестовая задача
```
На белом поле размером 1024x1024 клеток, в позиции 512,512 находится "муравей"

Муравей двигается по следующим правилам:

* На белой клетке - поворачивает на 90° по часовой стрелке, инвертирует пиксель и пермещается вперед на одну клетку
* На черной клетке - поворачиват на 90° против часовой стрелки, инвертирует пиксель и перемещается вперед на одну клетку

Изачально муравей находится на белой клетке и смотрит вверх.

Пришлите изображение пути муравья до границы поля в виде BMP или PNG файла глубиной цвета 1 бит и число черных клеток на нем.

Программа должна минимизировать исползование RAM.
```

Первый вариант решения с использованием массива numpy находится в файле ant_path.py.
Для сравнения потребления памяти имеется второй вариант с применением генератора списка, находится в файле ant_path_2.py.

Для профилирования потребления памяти использовался декоратор profile пакета memory_profiler.

Результаты профилирования ant_path.py:
```
Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    14     36.0 MiB     36.0 MiB           1   @profile
    15                                         def ant_path():
    16                                             # Размер стороны поля
    17     36.0 MiB      0.0 MiB           1       size = 1024
    18
    19                                             # Создание поля
    20     36.1 MiB      0.0 MiB           2       field = np.zeros(
    21     36.0 MiB      0.0 MiB           1           (size, size),
    22     36.0 MiB      0.0 MiB           1           dtype=np.uint8
    23                                             )
    24
    25                                             # Начальная позиция муравья
    26     36.1 MiB      0.0 MiB           1       x, y = size // 2, size // 2
    27
    28                                             # Начальное направление муравья
    29                                             # (0 - вверх, 1 - вправо, 2 - вниз, 3 - влево)
    30     36.1 MiB      0.0 MiB           1       direction = 0
    31
    32     36.6 MiB      0.0 MiB       35680       def move_ant(x, y, direction):
    33                                                 """
    34                                                 Перемещение муравья и инвертирование цвета клетки
    35                                                 """
    36
    37                                                 # Инвертирование цвета клетки
    38     36.6 MiB      0.6 MiB       35679           field[x, y] = invert_cell(field[x, y])
    39
    40                                                 # Поворот муравья
    41     36.6 MiB      0.0 MiB       71358           direction = ant_rotate(
    42     36.6 MiB      0.0 MiB       35679               field[x, y],
    43     36.6 MiB      0.0 MiB       35679               direction
    44                                                 )
    45
    46                                                 # Перемещение муравья
    47     36.6 MiB      0.0 MiB       35679           return ant_step(x, y, direction)
    48
    49                                             # Движение муравья до границы поля
    50     36.6 MiB      0.0 MiB       35680       while 0 < x < size and 0 < y < size:
    51     36.6 MiB      0.0 MiB       35679           x, y, direction = move_ant(x, y, direction)
    52
    53                                             # Преобразование поля в изображение и его сохранение
    54     38.1 MiB      1.5 MiB           1       image = Image.fromarray((1 - field) * 255)
    55     39.0 MiB      0.8 MiB           1       image.save('ant_path.png')
    56
    57                                             # Подсчет числа черных клеток на изображении
    58     39.0 MiB      0.0 MiB           1       black_pixels = np.sum(field)
    59     39.0 MiB      0.0 MiB           1       print(f"Число черных клеток: {black_pixels}")
```

Результаты профилирования ant_path_2.py:
```
Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    13     23.5 MiB     23.5 MiB           1   @profile
    14                                         def ant_path():
    15                                             # Размер стороны поля
    16     23.5 MiB      0.0 MiB           1       size = 1024
    17
    18                                             # Создание поля
    19     33.0 MiB      0.0 MiB        2052       field = [
    20     33.0 MiB      9.5 MiB     1051648           [0 for _ in range(size)]
    21     33.0 MiB      0.0 MiB        1025           for _ in range(size)
    22                                             ]
    23
    24                                             # Начальная позиция муравья
    25     33.0 MiB      0.0 MiB           1       x, y = size // 2, size // 2
    26
    27                                             # начальное направление муравья
    28                                             # (0 - вверх, 1 - вправо, 2 - вниз, 3 - влево)
    29     33.0 MiB      0.0 MiB           1       direction = 0
    30
    31     33.0 MiB      0.0 MiB       35680       def move_ant(x, y, direction):
    32                                                 """
    33                                                 Перемещение муравья и инвертирование цвета клетки
    34                                                 """
    35
    36                                                 # Инвертирование цвета клетки
    37     33.0 MiB      0.0 MiB       35679           field[x][y] = invert_cell(field[x][y])
    38
    39                                                 # Поворот муравья
    40     33.0 MiB      0.0 MiB       71358           direction = ant_rotate(
    41     33.0 MiB      0.0 MiB       35679               field[x][y],
    42     33.0 MiB      0.0 MiB       35679               direction
    43                                                 )
    44
    45                                                 # Перемещение муравья
    46     33.0 MiB      0.0 MiB       35679           return ant_step(x, y, direction)
    47
    48                                             # Движение муравья до границы поля
    49     33.0 MiB      0.0 MiB       35680       while 0 < x < size and 0 < y < size:
    50     33.0 MiB      0.0 MiB       35679           x, y, direction = move_ant(x, y, direction)
    51
    52                                             # Преобразование поля в изображение и его сохранение
    53     34.1 MiB      1.0 MiB           1       img = Image.new('1', (size, size))
    54     34.1 MiB      0.0 MiB           1       pixels = img.load()
    55     34.1 MiB      0.0 MiB        1025       for i in range(size):
    56     34.1 MiB      0.0 MiB     1049600           for j in range(size):
    57     34.1 MiB      0.0 MiB     1048576               pixels[j, i] = 1 - field[i][j]
    58     35.1 MiB      1.0 MiB           1       img.save('ant_path_2.png')
    59
    60                                             # Подсчет числа черных клеток на изображении
    61     36.7 MiB      1.5 MiB           1       black_pixels = sum(sum(field, []))
    62     36.7 MiB      0.0 MiB           1       print(f"Число черных клеток: {black_pixels}")
```
Как видно из таблиц, вариант с применением массива numpy использует на ~6,3 % памяти больше, чем вариант с 
генераторам списка. Это объясняется тем, что импортируемые модули загружаются в память, и во втором случае
нет необходимости загружать numpy.

Стоит отметить, что такой результат гарантирован только для данных условий. Другие исходные данные могут сделать более 
оптимальным по использованию памяти использование numpy array. Так, при увеличении стороны поля в два раза, результаты 
будут следующими:

Использование памяти при применении numpy для создания поля:
```
Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    14     35.9 MiB     35.9 MiB           1   @profile
    15                                         def ant_path():
    16                                             # Размер стороны поля
    17     35.9 MiB      0.0 MiB           1       size = 2048
    18
    19                                             # Создание поля
    20     35.9 MiB      0.0 MiB           2       field = np.zeros(
    21     35.9 MiB      0.0 MiB           1           (size, size),
    22     35.9 MiB      0.0 MiB           1           dtype=np.uint8
    23                                             )
    24
    25                                             # Начальная позиция муравья
    26     35.9 MiB      0.0 MiB           1       x, y = size // 2, size // 2
    27
    28                                             # Начальное направление муравья
    29                                             # (0 - вверх, 1 - вправо, 2 - вниз, 3 - влево)
    30     35.9 MiB      0.0 MiB           1       direction = 0
    31
    32     38.0 MiB      0.0 MiB       62304       def move_ant(x, y, direction):
    33                                                 """
    34                                                 Перемещение муравья и инвертирование цвета клетки
    35                                                 """
    36
    37                                                 # Инвертирование цвета клетки
    38     38.0 MiB      2.1 MiB       62303           field[x, y] = invert_cell(field[x, y])
    39
    40                                                 # Поворот муравья
    41     38.0 MiB      0.0 MiB      124606           direction = ant_rotate(
    42     38.0 MiB      0.0 MiB       62303               field[x, y],
    43     38.0 MiB      0.0 MiB       62303               direction
    44                                                 )
    45
    46                                                 # Перемещение муравья
    47     38.0 MiB      0.0 MiB       62303           return ant_step(x, y, direction)
    48
    49                                             # Движение муравья до границы поля
    50     38.0 MiB      0.0 MiB       62304       while 0 < x < size and 0 < y < size:
    51     38.0 MiB      0.0 MiB       62303           x, y, direction = move_ant(x, y, direction)
    52
    53                                             # Преобразование поля в изображение и его сохранение
    54     44.0 MiB      6.0 MiB           1       image = Image.fromarray((1 - field) * 255)
    55     44.8 MiB      0.8 MiB           1       image.save('ant_path.png')
    56
    57                                             # Подсчет числа черных клеток на изображении
    58     44.8 MiB      0.0 MiB           1       black_pixels = np.sum(field)
    59     44.8 MiB      0.0 MiB           1       print(f"Число черных клеток: {black_pixels}")
```

Использование памяти при применении list comprehension для создания поля:
```
Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    13     23.7 MiB     23.7 MiB           1   @profile
    14                                         def ant_path():
    15                                             # Размер стороны поля
    16     23.7 MiB      0.0 MiB           1       size = 2048
    17
    18                                             # Создание поля
    19     60.0 MiB      0.0 MiB        4100       field = [
    20     60.0 MiB     36.3 MiB     4200448           [0 for _ in range(size)]
    21     60.0 MiB      0.0 MiB        2049           for _ in range(size)
    22                                             ]
    23
    24                                             # Начальная позиция муравья
    25     60.0 MiB      0.0 MiB           1       x, y = size // 2, size // 2
    26
    27                                             # начальное направление муравья
    28                                             # (0 - вверх, 1 - вправо, 2 - вниз, 3 - влево)
    29     60.0 MiB      0.0 MiB           1       direction = 0
    30
    31     60.0 MiB      0.0 MiB       62304       def move_ant(x, y, direction):
    32                                                 """
    33                                                 Перемещение муравья и инвертирование цвета клетки
    34                                                 """
    35
    36                                                 # Инвертирование цвета клетки
    37     60.0 MiB      0.0 MiB       62303           field[x][y] = invert_cell(field[x][y])
    38
    39                                                 # Поворот муравья
    40     60.0 MiB      0.0 MiB      124606           direction = ant_rotate(
    41     60.0 MiB      0.0 MiB       62303               field[x][y],
    42     60.0 MiB      0.0 MiB       62303               direction
    43                                                 )
    44
    45                                                 # Перемещение муравья
    46     60.0 MiB      0.0 MiB       62303           return ant_step(x, y, direction)
    47
    48                                             # Движение муравья до границы поля
    49     60.0 MiB      0.0 MiB       62304       while 0 < x < size and 0 < y < size:
    50     60.0 MiB      0.0 MiB       62303           x, y, direction = move_ant(x, y, direction)
    51
    52                                             # Преобразование поля в изображение и его сохранение
    53     64.1 MiB      4.0 MiB           1       img = Image.new('1', (size, size))
    54     64.1 MiB      0.0 MiB           1       pixels = img.load()
    55     64.1 MiB    -80.2 MiB        2049       for i in range(size):
    56     64.1 MiB -164334.2 MiB     4196352           for j in range(size):
    57     64.1 MiB -164254.0 MiB     4194304               pixels[j, i] = 1 - field[i][j]
    58     65.0 MiB      1.0 MiB           1       img.save('ant_path_2.png')
    59
    60                                             # Подсчет числа черных клеток на изображении
    61     64.8 MiB     -0.3 MiB           1       black_pixels = sum(sum(field, []))
    62     64.8 MiB      0.0 MiB           1       print(f"Число черных клеток: {black_pixels}")
```

Как видно из таблиц, для способа с list comprehension наибольший прирост использования памяти происходит при создании
поля, и с его увеличением все выгоднее становится способ с numpy. При увеличении стороны поля в два раза вариант с list 
comprehension требует на ~45 % памяти больше, и при дальнейшем увеличении эта разница будет расти. Это объясняется тем,
что массив numpy хранится в виде одномерного блока памяти, в то время как вложенная генерация списка создает множество 
объектов Python, каждый из которых занимает свою область памяти.

Таким образом, в масштабе данных значений, оптимальнее по памяти будет использовать list comprehension, но с увеличением
значений, например, размера поля, может быть выгоднее способ с numpy array.

Число черных клеток на итоговом изображении: 3679.
Итоговое изображение:!


Инструкция для запуска:

1) Клонирование репозитория
```
git clone http://github.com/rednkul/ant_path.git
```
2) Установка зависимостей
```
pip install -r requirements.txt
```
3) Запуск варианта с массивом numpy:
```
python ant_path.py
```
4) Запуск варианта с list comprehension:
```
python ant_path_2.py
```


